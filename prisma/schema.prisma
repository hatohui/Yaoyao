generator client {
  provider = "prisma-client-js"
  output   =  "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Table {
  id            String   @id @default(uuid()) @db.Uuid
  name          String   
  capacity      Int      @default(2)
  tableLeaderId String?  @db.Uuid @unique
  isStaging     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  people      People[]    @relation("TableMembers")
  tableLeader People?     @relation("TableLeader", fields: [tableLeaderId], references: [id])
  orders      Order[]
  tableLink1  TableLink[] @relation("TableLinkTable1")
  tableLink2  TableLink[] @relation("TableLinkTable2")
  layout      Layout?

  @@index([isStaging])
  @@index([tableLeaderId])
}

model People {
  id        String   @id @default(uuid()) @db.Uuid
  name      String
  tableId   String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  table       Table   @relation("TableMembers", fields: [tableId], references: [id])
  tableLeader Table[] @relation("TableLeader")
}

model Food {
  id          String   @id @default(uuid()) @db.Uuid
  name        String
  imageUrl    String?
  description String?
  categoryId  String   @db.Uuid
  available   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  category    Category @relation(fields: [categoryId], references: [id])
  variants    FoodVariant[]
  translations FoodTranslation[]
  orders      Order[]
}

model FoodVariant {
  id        String   @id @default(uuid()) @db.Uuid
  foodId    String   @db.Uuid
  label     String   
  price     Float?   
  currency  String?  @default("RM") 
  available Boolean  @default(true)
  isSeasonal Boolean  @default(false)

  food      Food     @relation(fields: [foodId], references: [id])
  orders    Order[]
}

model FoodTranslation {
  id          String   @id @default(uuid()) @db.Uuid
  foodId      String   @db.Uuid
  language    String
  name        String
  description String?

  foods Food @relation(fields: [foodId], references: [id])

  @@unique([foodId, language])
  @@index([language])
}

model Category {
  id                  String                @id @default(uuid()) @db.Uuid
  name                String                @unique
  description         String?
  
  translation CategoryTranslation[]
  foods               Food[]
}

model CategoryTranslation {
  id          String  @id @default(uuid()) @db.Uuid
  categoryId  String  @db.Uuid
  language    String
  name        String
  description String?

  category Category @relation(fields: [categoryId], references: [id])

  @@unique([categoryId, language])
  @@index([language])
}

model Order {
  id        String   @id @default(uuid()) @db.Uuid
  tableId   String   @db.Uuid
  foodId    String   @db.Uuid
  variantId String?  @db.Uuid
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  table   Table        @relation(fields: [tableId], references: [id], onDelete: Cascade)
  food    Food         @relation(fields: [foodId], references: [id], onDelete: Cascade)
  variant FoodVariant? @relation(fields: [variantId], references: [id], onDelete: SetNull)

  @@index([tableId])
  @@index([foodId])
}

model Feedback {
  id        String   @id @default(uuid()) @db.Uuid
  by        String 
  content   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TableLink {
  id       String    @id @default(uuid()) @db.Uuid
  tableId   String   @db.Uuid 
  table2Id String    @db.Uuid 

  @@unique([tableId, table2Id])
  table    Table    @relation("TableLinkTable1", fields: [tableId], references: [id], onDelete: Cascade)
  table2   Table    @relation("TableLinkTable2", fields: [table2Id], references: [id], onDelete: Cascade)
}

model Layout {
  id        String   @id @default(uuid()) @db.Uuid
  slotName  String   @unique // e.g., "A1", "B3", "VIP-1"
  positionX Float    // Absolute X coordinate on the fixed layout image
  positionY Float    // Absolute Y coordinate on the fixed layout image
  tableId   String?  @db.Uuid @unique // Table assigned to this slot (nullable)
  isLocked  Boolean  @default(false) // When true, only Yaoyao can reassign tables
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  table Table? @relation(fields: [tableId], references: [id], onDelete: SetNull) 
} 